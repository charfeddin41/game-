<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة الجمع التفاعلية - الأستاذ بن وارث شرف الدين</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            margin: 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .game-area {
            padding: 40px;
        }
        
        .problem-display {
            text-align: center;
            font-size: 2.2em;
            font-weight: bold;
            color: #2c3e50;
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border: 3px solid #4CAF50;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .method-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .method-btn {
            background: linear-gradient(45deg, #FF6B6B, #ee5a52);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        
        .method-btn.method2 {
            background: linear-gradient(45deg, #4ECDC4, #44a08d);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }
        
        .method-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }
        
        .method-btn.method2:hover {
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
        }
        
        .method-btn.active {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .calculation-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 40px;
            margin: 30px 0;
            min-height: 500px;
            display: none;
        }
        
        .calculation-area.active {
            display: block;
        }
        
        .calculation-steps {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .step-row {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 25px 0;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            opacity: 0.3;
            transform: translateY(20px);
            transition: all 0.5s ease;
            border-right: 5px solid #ddd;
        }
        
        .step-row.active {
            opacity: 1;
            transform: translateY(0);
            border-right-color: #4CAF50;
        }
        
        .step-row.completed {
            opacity: 1;
            transform: translateY(0);
            border-right-color: #28a745;
            background: #f0f8f0;
        }
        
        .step-label {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
            min-width: 150px;
            text-align: right;
            margin-left: 20px;
        }
        
        .calculation-display {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
            font-family: 'Courier New', monospace;
            text-align: center;
            flex: 1;
        }
        
        .input-field {
            font-size: 1.8em;
            padding: 8px 12px;
            border: 3px solid #ddd;
            border-radius: 8px;
            text-align: center;
            width: 80px;
            margin: 0 5px;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }
        
        .excellent-message {
            position: absolute;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1em;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            animation: excellentPop 2s ease-out forwards;
            z-index: 1000;
            pointer-events: none;
        }
        
        @keyframes excellentPop {
            0% {
                transform: scale(0) translateY(0);
                opacity: 0;
            }
            20% {
                transform: scale(1.2) translateY(-20px);
                opacity: 1;
            }
            80% {
                transform: scale(1) translateY(-30px);
                opacity: 1;
            }
            100% {
                transform: scale(0.8) translateY(-40px);
                opacity: 0;
            }
        }
        
        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        
        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            transition: all 1.5s ease-out;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
            transform: scale(1.05);
        }
        
        .input-field.correct {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .input-field.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .nav-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .new-problem-btn {
            background: linear-gradient(45deg, #FF6B6B, #ee5a52);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            margin: 10px;
        }
        
        .new-problem-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        
        .score {
            background: linear-gradient(45deg, #9C27B0, #7B1FA2);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            display: inline-block;
            font-weight: bold;
            font-size: 1.2em;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.3);
        }
        
        .result-message {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-size: 1.3em;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .result-message.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .result-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .step-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #ddd;
            transition: all 0.3s;
        }
        
        .step-dot.active {
            background: #4CAF50;
            transform: scale(1.3);
        }
        
        .step-dot.completed {
            background: #28a745;
        }
        
        .arrow-down {
            text-align: center;
            font-size: 2em;
            margin: 15px 0;
            color: #4CAF50;
            opacity: 0.3;
            transition: all 0.5s ease;
        }
        
        .arrow-down.active {
            opacity: 1;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        /* تحسينات للشاشات الصغيرة جداً */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
                margin-bottom: 5px;
            }
            
            .header p {
                font-size: 1em;
            }
            
            .game-area {
                padding: 20px 15px;
            }
            
            .problem-display {
                font-size: 1.6em;
                padding: 20px 15px;
                margin: 20px 0;
            }
            
            .method-selector {
                flex-direction: column;
                gap: 15px;
                margin: 20px 0;
            }
            
            .method-btn {
                padding: 12px 20px;
                font-size: 0.95em;
                text-align: center;
                width: 100%;
                max-width: 300px;
            }
            
            .calculation-area {
                padding: 20px 10px;
                margin: 20px 0;
            }
            
            .step-row {
                flex-direction: column;
                text-align: center;
                padding: 15px 10px;
                margin: 15px 0;
            }
            
            .step-label {
                min-width: auto;
                margin: 0 0 10px 0;
                font-size: 1.1em;
            }
            
            .calculation-display {
                font-size: 1.4em;
                line-height: 1.4;
            }
            
            .input-field {
                font-size: 1.4em;
                width: 70px;
                padding: 6px 8px;
                margin: 5px 3px;
            }
            
            .controls {
                margin: 20px 0;
            }
            
            .new-problem-btn {
                padding: 12px 25px;
                font-size: 1.1em;
                width: 100%;
                max-width: 250px;
            }
            
            .score {
                padding: 12px 20px;
                font-size: 1.1em;
                margin: 8px 5px;
                display: block;
                width: 100%;
                max-width: 300px;
                margin-left: auto;
                margin-right: auto;
            }
            
            .result-message {
                font-size: 1.1em;
                padding: 15px;
                margin: 15px 0;
            }
            
            .arrow-down {
                font-size: 1.5em;
                margin: 10px 0;
            }
        }
        
        /* تحسينات للأجهزة اللوحية والشاشات المتوسطة */
        @media (min-width: 481px) and (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .game-area {
                padding: 30px 25px;
            }
            
            .problem-display {
                font-size: 2em;
                padding: 20px;
            }
            
            .method-selector {
                flex-direction: column;
                gap: 15px;
                align-items: center;
            }
            
            .method-btn {
                width: 100%;
                max-width: 400px;
                padding: 15px 25px;
            }
            
            .calculation-area {
                padding: 30px 20px;
            }
            
            .step-row {
                flex-direction: column;
                text-align: center;
                padding: 20px 15px;
            }
            
            .step-label {
                min-width: auto;
                margin: 0 0 15px 0;
                font-size: 1.2em;
            }
            
            .calculation-display {
                font-size: 1.6em;
            }
            
            .input-field {
                font-size: 1.6em;
                width: 80px;
                margin: 5px;
            }
            
            .score {
                margin: 10px 8px;
                display: inline-block;
            }
        }
        
        /* تحسينات للشاشات الكبيرة */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 900px;
            }
            
            .calculation-steps {
                max-width: 700px;
            }
            
            .step-row {
                padding: 25px 20px;
            }
            
            .calculation-display {
                font-size: 1.9em;
            }
            
            .input-field {
                font-size: 1.9em;
                width: 85px;
            }
        }
        
        /* تحسينات للشاشات الكبيرة جداً */
        @media (min-width: 1200px) {
            .container {
                max-width: 1100px;
            }
            
            .header h1 {
                font-size: 2.8em;
            }
            
            .problem-display {
                font-size: 2.5em;
                padding: 30px;
            }
            
            .calculation-steps {
                max-width: 800px;
            }
            
            .step-row {
                padding: 30px 25px;
            }
            
            .calculation-display {
                font-size: 2.1em;
            }
            
            .input-field {
                font-size: 2.1em;
                width: 90px;
                padding: 10px 15px;
            }
        }
        
        /* تحسينات للشاشات العريضة جداً */
        @media (min-width: 1600px) {
            .container {
                max-width: 1200px;
            }
            
            .game-area {
                padding: 50px;
            }
            
            .calculation-area {
                padding: 50px 40px;
            }
        }
        
        /* تحسينات للاتجاه الأفقي على الهواتف */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                padding: 15px 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .game-area {
                padding: 20px;
            }
            
            .problem-display {
                margin: 15px 0;
                padding: 20px;
            }
            
            .calculation-area {
                padding: 25px 15px;
                min-height: 300px;
            }
            
            .step-row {
                margin: 15px 0;
                padding: 15px;
            }
            
            .method-selector {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .method-btn {
                width: auto;
                min-width: 200px;
                flex: 1;
                max-width: 300px;
            }
        }
        
        /* تحسين عرض النقاط للشاشات الصغيرة */
        @media (max-width: 600px) {
            .controls {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .score {
                width: 100%;
                max-width: 280px;
                text-align: center;
            }
        }
        
        /* تحسين الرسائل للشاشات الصغيرة */
        @media (max-width: 480px) {
            .excellent-message {
                font-size: 0.9em;
                padding: 6px 12px;
            }
            
            .firework {
                width: 4px;
                height: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧮 لعبة الجمع التفاعلية</h1>
            <p>تصميم الأستاذ بن وارث شرف الدين - العرض التدريجي</p>
        </div>
        
        <div class="game-area">
            <div class="problem-display" id="problem">
                اضغط "مسألة جديدة" للبدء
            </div>
            
            <div class="method-selector">
                <button class="method-btn" onclick="selectMethod(1)">
                    🔢 الطريقة الأولى: تفكيك العدد الأول
                </button>
                <button class="method-btn method2" onclick="selectMethod(2)">
                    🎯 الطريقة الثانية: المتمم إلى العشرة
                </button>
            </div>
            
            <div class="calculation-area" id="calculationArea">
                <div class="calculation-steps" id="calculationSteps">
                    <!-- سيتم إنشاء الخطوات هنا -->
                </div>
            </div>
            
            <div class="step-indicator" id="stepIndicator"></div>
            

            
            <div class="controls">
                <button class="new-problem-btn" onclick="generateNewProblem()">مسألة جديدة</button>
                <div class="score" id="score">النقاط: 0</div>
                <div class="score" id="detailedScore" style="background: linear-gradient(45deg, #FF9800, #F57C00); margin-top: 10px;">المسألة الحالية: 0 / 10</div>
            </div>
            
            <div class="result-message" id="resultMessage"></div>
        </div>
    </div>

    <script>
        let currentProblem = {};
        let currentMethod = 0;
        let currentStep = 0;
        let score = 0;
        let currentProblemScore = 0;
        let userAnswers = {};

        function generateNewProblem() {
            // توليد عدد من رقمين
            const twoDigitNumber = Math.floor(Math.random() * 90) + 10;
            
            // حساب العشرة التالية والمتمم
            const nextTen = Math.ceil(twoDigitNumber / 10) * 10;
            const complement = nextTen - twoDigitNumber;
            
            // توليد عدد ثاني يكون أكبر من المتمم ليكون له باقي
            const oneDigitNumber = complement + Math.floor(Math.random() * (9 - complement)) + 1;
            
            currentProblem = {
                first: twoDigitNumber,
                second: oneDigitNumber,
                answer: twoDigitNumber + oneDigitNumber
            };
            
            const problemElement = document.getElementById('problem');
            problemElement.textContent = `${currentProblem.first} + ${currentProblem.second}`;
            problemElement.setAttribute('dir', 'ltr');
            
            // إعادة تعيين المتغيرات
            currentMethod = 0;
            currentStep = 0;
            currentProblemScore = 0;
            userAnswers = {};
            
            // تحديث عرض النقاط
            updateScoreDisplay();
            
            // إخفاء منطقة الحسابات
            document.getElementById('calculationArea').classList.remove('active');
            document.getElementById('stepIndicator').innerHTML = '';
            document.getElementById('resultMessage').textContent = '';
            document.getElementById('resultMessage').className = 'result-message';
            

            
            // إزالة التحديد من أزرار الطرق
            document.querySelectorAll('.method-btn').forEach(btn => btn.classList.remove('active'));
        }

        function selectMethod(method) {
            currentMethod = method;
            currentStep = 0;
            currentProblemScore = 0;
            userAnswers = {};
            
            // تحديث عرض النقاط
            updateScoreDisplay();
            
            // تحديد الطريقة المختارة
            document.querySelectorAll('.method-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.method-btn')[method - 1].classList.add('active');
            
            // إظهار منطقة الحسابات
            document.getElementById('calculationArea').classList.add('active');
            
            // إنشاء الخطوات حسب الطريقة المختارة
            if (method === 1) {
                createMethod1Steps();
            } else {
                createMethod2Steps();
            }
            
            // إنشاء مؤشرات الخطوات
            createStepIndicators(method === 1 ? 4 : 4);
            
            // تفعيل الخطوة الأولى
            activateStep(0);
            

        }

        function createMethod1Steps() {
            const container = document.getElementById('calculationSteps');
            const tens = Math.floor(currentProblem.first / 10) * 10;
            const ones = currentProblem.first % 10;
            
            container.innerHTML = `
                <div class="step-row" id="step0">
                    <div class="step-label">المسألة الأصلية:</div>
                    <div class="calculation-display" dir="ltr">${currentProblem.first} + ${currentProblem.second}</div>
                </div>
                
                <div class="arrow-down">⬇️</div>
                
                <div class="step-row" id="step1">
                    <div class="step-label">تفكيك العدد الأول:</div>
                    <div class="calculation-display" dir="ltr">
                        <input type="number" class="input-field" id="tens" oninput="checkInput('tens', ${tens})"> + 
                        <input type="number" class="input-field" id="ones" oninput="checkInput('ones', ${ones})">
                    </div>
                </div>
                
                <div class="arrow-down">⬇️</div>
                
                <div class="step-row" id="step2">
                    <div class="step-label">إعادة كتابة المسألة:</div>
                    <div class="calculation-display" dir="ltr"><span id="tensDisplay">__</span> + <span id="onesDisplay">__</span> + ${currentProblem.second}</div>
                </div>
                
                <div class="arrow-down">⬇️</div>
                
                <div class="step-row" id="step3">
                    <div class="step-label">جمع الآحاد:</div>
                    <div class="calculation-display" dir="ltr">
                        <span id="tensDisplay2">__</span> + <span id="onesDisplay2">__</span> + ${currentProblem.second} = <span id="tensDisplay3">__</span> + 
                        <input type="number" class="input-field" id="onesSum" oninput="checkInput('onesSum', ${ones + currentProblem.second})">
                    </div>
                </div>
                
                <div class="arrow-down">⬇️</div>
                
                <div class="step-row" id="step4">
                    <div class="step-label">النتيجة النهائية:</div>
                    <div class="calculation-display" dir="ltr">
                        <span id="tensDisplay4">__</span> + <span id="onesSumDisplay">__</span> = 
                        <input type="number" class="input-field" id="finalResult" oninput="checkFinalResult('finalResult', ${currentProblem.answer})">
                    </div>
                </div>
            `;
        }

        function createMethod2Steps() {
            const container = document.getElementById('calculationSteps');
            const nextTen = Math.ceil(currentProblem.first / 10) * 10;
            const complement = nextTen - currentProblem.first;
            const remainder = currentProblem.second - complement;
            
            container.innerHTML = `
                <div class="step-row" id="step0">
                    <div class="step-label">المسألة الأصلية:</div>
                    <div class="calculation-display" dir="ltr">${currentProblem.first} + ${currentProblem.second}</div>
                </div>
                
                <div class="arrow-down">⬇️</div>
                
                <div class="step-row" id="step1">
                    <div class="step-label">العشرة التالية:</div>
                    <div class="calculation-display">
                        العشرة التالية لـ ${currentProblem.first} هي: 
                        <input type="number" class="input-field" id="nextTen" oninput="checkInput('nextTen', ${nextTen})">
                    </div>
                </div>
                
                <div class="arrow-down">⬇️</div>
                
                <div class="step-row" id="step2">
                    <div class="step-label">حساب المتمم:</div>
                    <div class="calculation-display" dir="ltr">
                        ${currentProblem.first} + 
                        <input type="number" class="input-field" id="complement" oninput="checkInput('complement', ${complement})"> = 
                        <span id="nextTenDisplay">__</span>
                    </div>
                </div>
                
                <div class="arrow-down">⬇️</div>
                
                <div class="step-row" id="step3">
                    <div class="step-label">الباقي من المتمم:</div>
                    <div class="calculation-display" dir="ltr">
                        ${currentProblem.second} - <span id="complementDisplay">__</span> = 
                        <input type="number" class="input-field" id="remainder" oninput="checkInput('remainder', ${remainder})">
                    </div>
                </div>
                
                <div class="arrow-down">⬇️</div>
                
                <div class="step-row" id="step4">
                    <div class="step-label">النتيجة النهائية:</div>
                    <div class="calculation-display" dir="ltr">
                        <span id="nextTenDisplay2">__</span> + <span id="remainderDisplay">__</span> = 
                        <input type="number" class="input-field" id="finalResult" oninput="checkFinalResult('finalResult', ${currentProblem.answer})">
                    </div>
                </div>
            `;
        }

        function checkInput(inputId, correctValue) {
            const input = document.getElementById(inputId);
            const value = parseInt(input.value);
            
            if (value === correctValue) {
                input.classList.remove('incorrect');
                input.classList.add('correct');
                userAnswers[inputId] = value;
                
                // إضافة نقطة للمسألة الحالية إذا لم تكن محسوبة من قبل
                if (!userAnswers[inputId + '_scored']) {
                    currentProblemScore = 10; // دائماً 10 نقاط كاملة
                    userAnswers[inputId + '_scored'] = true;
                    updateScoreDisplay();
                }
                
                // إظهار رسالة "ممتاز"
                showExcellentMessage(input);
                
                // تحديث العروض المرتبطة
                updateDisplays(inputId, value);
                
                // التحقق من إمكانية الانتقال للخطوة التالية
                checkStepCompletion();
            } else if (input.value !== '') {
                input.classList.remove('correct');
                input.classList.add('incorrect');
            }
        }
        
        function showExcellentMessage(inputElement) {
            const message = document.createElement('div');
            message.className = 'excellent-message';
            message.textContent = '🌟 ممتاز!';
            
            // تحديد موقع الرسالة بالنسبة لحقل الإدخال
            const rect = inputElement.getBoundingClientRect();
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
            
            message.style.left = (rect.left + scrollLeft + rect.width / 2 - 40) + 'px';
            message.style.top = (rect.top + scrollTop - 50) + 'px';
            
            document.body.appendChild(message);
            
            // إزالة الرسالة بعد انتهاء الأنيميشن
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, 2000);
        }
        
        function createFireworks() {
            const fireworksContainer = document.createElement('div');
            fireworksContainer.className = 'fireworks';
            document.body.appendChild(fireworksContainer);
            
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
            
            // إنشاء عدة انفجارات
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createSingleFirework(fireworksContainer, colors);
                }, i * 200);
            }
            
            // إزالة الألعاب النارية بعد انتهائها
            setTimeout(() => {
                if (fireworksContainer.parentNode) {
                    fireworksContainer.parentNode.removeChild(fireworksContainer);
                }
            }, 3000);
        }
        
        function createSingleFirework(container, colors) {
            const centerX = Math.random() * (window.innerWidth - 200) + 100;
            const centerY = Math.random() * (window.innerHeight / 3) + 100;
            
            // إنشاء شرارات الألعاب النارية
            for (let i = 0; i < 15; i++) {
                const spark = document.createElement('div');
                spark.className = 'firework';
                const color = colors[Math.floor(Math.random() * colors.length)];
                spark.style.backgroundColor = color;
                spark.style.boxShadow = `0 0 15px ${color}, 0 0 30px ${color}`;
                spark.style.width = '8px';
                spark.style.height = '8px';
                
                const angle = (i * 24) * Math.PI / 180;
                const distance = 100 + Math.random() * 80;
                
                spark.style.left = centerX + 'px';
                spark.style.top = centerY + 'px';
                spark.style.opacity = '1';
                spark.style.transform = 'scale(1)';
                
                container.appendChild(spark);
                
                // تحريك الشرارة مع تأثير محسن
                setTimeout(() => {
                    spark.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0.2)`;
                    spark.style.opacity = '0';
                }, 50);
                
                // إزالة الشرارة بعد انتهاء الأنيميشن
                setTimeout(() => {
                    if (spark.parentNode) {
                        spark.parentNode.removeChild(spark);
                    }
                }, 1600);
            }
        }

        function updateDisplays(inputId, value) {
            // تحديث العروض حسب نوع الإدخال
            if (inputId === 'tens') {
                const displays = document.querySelectorAll('#tensDisplay, #tensDisplay2, #tensDisplay3, #tensDisplay4');
                displays.forEach(display => display.textContent = value);
            } else if (inputId === 'ones') {
                const displays = document.querySelectorAll('#onesDisplay, #onesDisplay2');
                displays.forEach(display => display.textContent = value);
            } else if (inputId === 'onesSum') {
                const displays = document.querySelectorAll('#onesSumDisplay');
                displays.forEach(display => display.textContent = value);
            } else if (inputId === 'nextTen') {
                const displays = document.querySelectorAll('#nextTenDisplay, #nextTenDisplay2');
                displays.forEach(display => display.textContent = value);
            } else if (inputId === 'complement') {
                const displays = document.querySelectorAll('#complementDisplay');
                displays.forEach(display => display.textContent = value);
            } else if (inputId === 'remainder') {
                const displays = document.querySelectorAll('#remainderDisplay');
                displays.forEach(display => display.textContent = value);
            }
        }

        function checkStepCompletion() {
            const currentStepElement = document.getElementById(`step${currentStep + 1}`);
            if (!currentStepElement) return;
            
            const inputs = currentStepElement.querySelectorAll('.input-field');
            const allCorrect = Array.from(inputs).every(input => input.classList.contains('correct'));
            
            if (allCorrect) {
                // تمييز الخطوة كمكتملة
                currentStepElement.classList.add('completed');
                
                // إذا كانت الخطوة الأخيرة، عرض رسالة النجاح فوراً
                if (currentStep >= 3) {
                    setTimeout(() => {
                        showCompletionMessage();
                    }, 300);
                } else {
                    // الانتقال تلقائياً للخطوة التالية
                    setTimeout(() => {
                        activateStep(currentStep + 1);
                    }, 500);
                }
            }
        }
        
        function checkFinalResult(inputId, correctValue) {
            const input = document.getElementById(inputId);
            const value = parseInt(input.value);
            
            if (value === correctValue) {
                input.classList.remove('incorrect');
                input.classList.add('correct');
                userAnswers[inputId] = value;
                
                // إضافة نقطة للمسألة الحالية إذا لم تكن محسوبة من قبل
                if (!userAnswers[inputId + '_scored']) {
                    currentProblemScore = 10; // دائماً 10 نقاط كاملة
                    userAnswers[inputId + '_scored'] = true;
                    updateScoreDisplay();
                }
                
                // إظهار رسالة "ممتاز"
                showExcellentMessage(input);
                
                // عرض النتيجة النهائية فوراً
                setTimeout(() => {
                    showCompletionMessage();
                }, 300);
                
            } else if (input.value !== '') {
                input.classList.remove('correct');
                input.classList.add('incorrect');
            }
        }

        function activateStep(stepIndex) {
            // إلغاء تفعيل جميع الخطوات والأسهم
            document.querySelectorAll('.step-row').forEach(row => {
                row.classList.remove('active');
            });
            document.querySelectorAll('.arrow-down').forEach(arrow => {
                arrow.classList.remove('active');
            });
            
            // تفعيل الخطوات حتى الخطوة الحالية
            for (let i = 0; i <= stepIndex + 1; i++) {
                const stepElement = document.getElementById(`step${i}`);
                if (stepElement) {
                    stepElement.classList.add('active');
                }
            }
            
            // تفعيل الأسهم حتى الخطوة الحالية
            const arrows = document.querySelectorAll('.arrow-down');
            for (let i = 0; i <= stepIndex; i++) {
                if (arrows[i]) {
                    arrows[i].classList.add('active');
                }
            }
            
            currentStep = stepIndex;
            updateStepIndicators();
            updateNavigationButtons();
        }



        function createStepIndicators(totalSteps) {
            const indicator = document.getElementById('stepIndicator');
            indicator.innerHTML = '';
            
            for (let i = 0; i < totalSteps; i++) {
                const dot = document.createElement('div');
                dot.className = 'step-dot';
                if (i === 0) dot.classList.add('active');
                indicator.appendChild(dot);
            }
        }

        function updateStepIndicators() {
            const dots = document.querySelectorAll('.step-dot');
            dots.forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index < currentStep) {
                    dot.classList.add('completed');
                } else if (index === currentStep) {
                    dot.classList.add('active');
                }
            });
        }



        function updateScoreDisplay() {
            document.getElementById('detailedScore').textContent = `المسألة الحالية: ${currentProblemScore} / 10`;
        }

        function showCompletionMessage() {
            // العلامة دائماً 10/10
            const finalGrade = 10;
            
            // تحديث النقاط الإجمالية
            score += finalGrade;
            
            // تحديث عرض النقاط - إظهار النقاط فقط
            document.getElementById('score').textContent = `النقاط: ${score}`;
            
            const resultDiv = document.getElementById('resultMessage');
            resultDiv.className = 'result-message success';
            resultDiv.innerHTML = `
                🎉 ممتاز! لقد أكملت الحل بنجاح!<br>
                النتيجة الصحيحة: ${currentProblem.first} + ${currentProblem.second} = ${currentProblem.answer}<br>
                <strong>🌟 علامتك النهائية: ${finalGrade}/10 🌟</strong>
            `;
            
            // إطلاق الألعاب النارية مع تأخير قصير
            setTimeout(() => {
                createFireworks();
            }, 100);
        }



        // توليد مسألة عند تحميل الصفحة
        window.onload = function() {
            generateNewProblem();
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'987543919166b6d1',t:'MTc1OTI1MTQ5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
